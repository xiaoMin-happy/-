# session和cookies

## 一. 动态网页和静态网页

### 1. 静态网页

- html页面，后缀为.html的文件，直接部署到某个web容器上，就可以在浏览器中通过链接访问
- 优点：通过HTML代码书写，一些资源(如图片，视频等)的引入都是通过HTML标签树完成，加载速度快，编写简单，访问时对于web容器基本无压力
- 缺点：可维护性差，不能根据参数动态的显示内容

### 2. 动态网页

- 现在常用的网站都是由董动态网页组成的
- 动态网页可以解析URL中的参数，或者关联数据库中的数据，显示不同的网页内容。不再由HTML简单堆砌而成，可能是由JSP、PHP等语言编写
- 动态网页使用频率最高的一个功能就是登陆

### 3. http1.0

- HTTP1.0的特点是无状态无链接的

- 无状态：HTTP协议对于请求的发送处理是没有记忆功能的。也就是说每次HTTP请求到达服务端，服务端并不知道当前的客户端（浏览器）是什么状态，服务端处理这个请求后将内容响应给客户端，完成一次交互，这个过程是完全相互独立的，服务端没有状态记录，即不会记录这个前后的变化。
- 服务端如何记录客户端的登录：用户在做登陆操作时，服务端会下发一个类似token凭证的东西返回至客户端(浏览器)，有了这个凭证才能保持登陆状态

## 二、session和cookies

- session：会话的意思，产生在**服务端**，用来保存当前用户的会话信息

- Cookies：相当于登陆凭证，保存在**客户端(服务器)**，客户端(浏览器)再次访问服务端时，会带着这个cookies，此时服务端可以通过这个cookies识别本次请求是谁在访问

### 1. session

Cookies保持会话状态的过程

- 客户端第一次请求服务端时，服务端会返回一个请求头中带有Set-Cookie的字段(标记用户)响应给客户端，客户端会保存这个Cookies
- 例如登陆时，输入完用户名和密码后，客户端会将这个Cookies放在请求头一起发送给服务端
- 服务端对Cookies进行判断，如果正确，则在服务端的Session记录下这个客户端登录成功，下次请求时，就是已登陆状态；如果Cookies无效或过期或不是服务端发的，则客户端的请求将不能访问需要登陆的页面

### 2. cookies

​	![京东cookies](https://user-images.githubusercontent.com/62495140/80281561-9d008300-873e-11ea-93b1-527c01826ff3.jpg)

- Name：Cookie的名字，一旦创建不能更该
- Value：Cookie的值
- Domain：可以访问该Cookie的域名，比如设置为 .jd.com ，则所有以 jd.com ，结尾的域名都可以访问该Cookie
- Max Age：Cookie 失效的时间，单位为秒，也常和 Expires 一起使用。 Max Age 如果为正数，则在 Max Age 秒之后失效，如果为负数，则关闭浏览器时 Cookie 即失效，浏览器也不会保存该 Cookie 
- Path：Cookie 的使用路径。如果设置为 /path/ ，则只有路径为 /path/ 的页面可以访问该 Cookie 。如果设置为 / ，则本域名下的所有页面都可以访问该 Cookie 
- Size：Cookie 的大小
- HTTPOnly：如果此项打勾，那么通过 JS 脚本将无法读取到 Cookie 信息，这样能有效的防止 XSS 攻击，窃取 Cookie 内容，可以增加 Cookie 的安全性
- Secure：如果此项打勾，那么这个 Cookie 只能用 HTTPS 协议发送给服务器，用 HTTP 协议是不发送的

（1）为什么关闭网站后，下次打开还是登陆状态？

—— Cookie 失效的时间设置的长一点，比如直接设置到 2099 年失效，这样，在浏览器关闭后，这个 Cookie 是会保存在我们的硬盘中的，下次打开浏览器，会再从我们的硬盘中将这个 Cookie 读取出来，用来维持用户的会话状态。

（2）服务端的会话也会无限的维持下去么？

——不会。在下次将 Cookies 读取出来由请求发送到服务端后，服务端悄悄的自己创建一个用户已经登录的会话，这样我们在客户端看起来就好像这个登录会话是一直保持的。

（3）在关闭浏览器的时候，浏览器并不会额外的通知服务端，所以**关闭浏览器时服务端的会话不会自动销毁**。因为服务端的会话是保存在内存中的，因为内存有限，所以**在服务端设置会话的过期时间就非常有必要**。